

## 🏗️ 总体架构方案

```mermaid
graph TD
    subgraph 前端
        UI1[LibreChat 前端] 
        UI2[业务管理前端]
    end

    subgraph 网关
        Nginx[统一反向代理 + SSO]
    end

    subgraph 后端
        LCAPI[LibreChat API<br/>对接 OpenRouter]
        RAGAPI[RAG 服务<br/>文档解析+向量检索]
        ERPAPI[业务管理 API]
    end

    subgraph 数据层
        MongoDB[(会话 & 业务数据)]
        VectorDB[(向量数据库 Qdrant/Weaviate)]
        Files[(文件存储 MinIO)]
    end

    UI1 --> Nginx --> LCAPI
    UI2 --> Nginx --> ERPAPI
    LCAPI --> MongoDB
    ERPAPI --> MongoDB
    RAGAPI --> VectorDB
    RAGAPI --> Files
    LCAPI --> RAGAPI
```

---

## 1️⃣ 聊天系统（LibreChat 替代）

- **推荐项目**：[LibreChat](https://github.com/danny-avila/LibreChat)  
  - 多模型支持（通过OpenRouter访问OpenAI、Claude、Gemini 等）  
  - 多用户、权限管理  
  - 文件上传、联网搜索、插件系统  
  - 完全开源，Docker 一键部署  
- **改造点**：
  - 在 `librechat.yaml` 中配置 OpenRouter API 作为唯一模型端点  
  - 通过OpenRouter访问各种AI模型，统一管理  

---

## 2️⃣ RAG 检索增强生成

- **推荐项目**：[RAGFlow](https://juejin.cn/post/7505779445468774434) 或 [Haystack](https://juejin.cn/post/7505779445468774434)  
  - 支持 PDF/Word/网页等多格式解析  
  - 混合检索（BM25 + 向量检索）  
  - 可与 LibreChat 集成，实现“带知识库的聊天”  
- **部署建议**：
  - 向量数据库用 **Qdrant**（轻量高性能）  
  - 文档存储用 **MinIO**（S3 兼容）  
  - 暴露 REST API 给 LibreChat 调用  

---

## 3️⃣ 业务管理模块（基于之前的需求说明）

- **推荐项目**：  
  - **ERPNext**（全功能 ERP/CRM/项目/财务）  
  - 或 **REBUILD**（零代码企业管理平台，易定制）  
- **集成方式**：
  - 与 LibreChat 共用 SSO（单点登录）  
  - 在业务管理界面内嵌 AI 助手（调用 LibreChat API）  
  - 业务数据可作为 RAG 知识源，供 AI 分析  

---

## 4️⃣ OpenRouter API 接入

- 在 LibreChat 配置文件中添加：
```yaml
endpoints:
  - name: openrouter
    type: openai
    base_url: https://openrouter.ai/api/v1
    api_key: ${OPENROUTER_API_KEY}
```
- RAG 服务调用 LLM 时，也统一走 OpenRouter API  
- 好处：统一计费、统一模型管理、可随时切换模型  

---

## 📦 推荐目录结构

```
myai-suite/
├── librechat/         # 聊天系统
├── rag-service/       # RAG 检索服务
├── erp/               # 业务管理系统
├── gateway/           # Nginx + SSO
├── docker-compose.yml # 一键启动
└── .env               # API Key、数据库配置
```

---

## 🔧 本阶段技术实现记录 (v1.1.0)

### 服务启动优化

#### 1. 后端服务问题修复
- **问题**: `TypeError: loggerModule.errorLogger is not a function`
- **原因**: `emailService.js`中调用了不存在的`errorLogger`方法
- **解决**: 将`loggerModule.errorLogger`修改为`loggerModule.error`
- **文件**: `/server/services/emailService.js`

#### 2. 前端服务缺失文件补充
- **问题**: `Module not found: Can't resolve './styles/index.css'`和`./reportWebVitals`
- **解决**: 
  - 创建`/client/src/styles/index.css`全局样式文件
  - 创建`/client/src/reportWebVitals.js`性能监控模块
- **影响**: 前端服务成功启动并运行在端口3000

#### 3. 服务启动顺序和健康检查
- **向量数据库**: Qdrant启动在端口6333，配置文件`qdrant-config.yaml`
- **RAG服务**: 端口3002，成功连接MongoDB和Qdrant
- **后端服务**: 端口3001，健康检查端点`/health`正常响应
- **前端服务**: 端口3000，React开发服务器正常运行

### 技术栈验证
- ✅ MongoDB连接正常
- ✅ Redis连接正常  
- ✅ Qdrant向量数据库运行正常
- ✅ OpenRouter API集成正常
- ✅ 所有服务间通信正常

### 部署状态
- **开发环境**: 所有服务已启动并验证
- **访问地址**:
  - 前端: http://localhost:3000
  - 后端API: http://localhost:3001
  - RAG服务: http://localhost:3002
  - 向量数据库: http://localhost:6333

---

## 🚀 部署建议

- **方式**：Docker Compose（单机）或 Kubernetes（生产）  
- **数据库**：
  - MongoDB：LibreChat 会话 & 业务数据  
  - Qdrant：RAG 向量存储  
- **存储**：
  - MinIO：文档、合同、附件  
- **安全**：
  - 全站 HTTPS  
  - API Key 管理  
  - RBAC 权限控制  

---

